flowchart TD
  subgraph Host
    H_Admin["Browser / Developer (host)"]
  end

  %% Kong can be deployed either on the host (external) or as a container.
  %% We model it here as part of the Compose network (a container) so it
  %% clearly sits in front of the other service containers and is reachable
  %% by the host on mapped ports.

  subgraph Compose_Network[Docker Compose network]
    KongGW["Kong (proxy) \nhost: 8080 / 8443 \n(container) "]
    Admin["admin-web\n(container) \nport: 3000 "]
    Openapi["openapi (static) \nport: 80 "]
    Perl["perl-api\n(container) \nport: 5000 "]
    Java["java-api\n(container) \nport: 8080 "]
    Federation["federation\n(container) \nport: 5001 "]
    DB["postgres (db) \nport: 5432 "]
  end

  %% Host -> Kong -> services (proxied)
  H_Admin --- KongGW
  KongGW ---|http | Admin
  KongGW ---|http | Openapi
  KongGW ---|http | Java
  KongGW ---|http | Perl
  KongGW ---|http | Federation

  %% Container internal communication (service name resolution)
  Admin -->|http| Perl
  Admin -->|http| Java
  Admin -->|http| Federation
  Perl -->|SQL| DB
  Java -->|SQL| DB
  Federation -->|SQL| DB

  classDef svc fill:#f8fafc,stroke:#e6eef8
  class Admin,Openapi,Perl,Java,Federation,DB svc
